# ============================================================================
# TEST 3: Empresa Redirigida por Ingresos Bajos
# ============================================================================
# Verifica que empresa con ingresos < 350M NO es redirigida al flujo B2C
# de persona natural (comportamiento anterior que debe eliminarse)
# ============================================================================

name: "Empresa Redirigida (Ingresos) - Verificar NO redireccion a B2C"
description: "Verifica que empresa con ingresos < 350M NO es redirigida al flujo B2C de persona natural"

agent_id: "126"
provider: "viernes"

viernes:
  organization_id: 58
  agent_id: 126
  platform: "whatsapp"
  max_turns: 12
  conversation_timeout: 300
  webhook_timeout: 60

simulated_user:
  prompt: |
    Eres Carlos Lopez, representante de una pequena empresa.
    Tu empresa tiene ingresos anuales de 200 millones de pesos.
    La empresa tiene 3 anos de constituida.
    Responde en espanol, de forma breve y cooperativa.

    Cuando te pregunten por email: carlos@miempresa.com
    Cuando te pregunten nombre: Carlos Lopez
    Cuando pregunten si es empresa o persona natural: empresa
    Cuando pregunten nombre y NIT: Mi Empresa SAS, NIT 900123456-1
    Cuando pregunten ingresos anuales: aproximadamente 200 millones
    Cuando pregunten antiguedad: 3 anos

    Si despues te preguntan si eres empleado o independiente (flujo persona natural):
    - Responde: "Pero yo represento a una empresa, no soy persona natural"
    - Si insisten: independiente

    Responde maximo 1-2 oraciones por mensaje.
  first_message: "Hola, necesito renting para mi empresa"
  language: "es"
  llm: "gpt-4o-mini"
  temperature: 0.3
  max_tokens: 100

evaluation_criteria:
  - id: "no-redirect-natural"
    name: "No redirige a flujo persona natural"
    prompt: "Verifica que el agente NO redirigio la conversacion al flujo de persona natural (no pregunto si es empleado o independiente despues de saber que es empresa)."

  - id: "no-datacredito-question"
    name: "Sin pregunta de Datacredito B2C"
    prompt: "El agente NO pregunto por reportes en Datacredito en contexto de persona natural?"

  - id: "no-bank-statements-question"
    name: "Sin pregunta de extractos B2C"
    prompt: "El agente NO solicito extractos bancarios personales?"

  - id: "appropriate-response"
    name: "Respuesta apropiada para empresa pequena"
    prompt: "El agente dio una respuesta apropiada para una empresa que no califica para el flujo B2B estandar sin redirigir a B2C?"

  - id: "professional-tone"
    name: "Tono profesional mantenido"
    prompt: "El agente mantuvo tono profesional durante toda la interaccion?"

expected_structured_data:
  - field_name: "funnel"
    expected_value: "B2C"
    match_mode: "contains"
    capture_strategy: "last"
    required: false
    description: "El funnel NO debe contener B2C - test FALLA si la empresa fue redirigida a flujo B2C"
