# ============================================================================
# TEST 10: Empresa en Limite Exacto 350M
# ============================================================================
# Verifica el comportamiento correcto cuando empresa tiene EXACTAMENTE
# 350 millones de ingresos (caso frontera)
# ============================================================================

name: "Empresa Limite 350M - Verificar comportamiento frontera"
description: "Verifica que empresa con EXACTAMENTE 350M de ingresos NO es redirigida a B2C"

agent_id: "126"
provider: "viernes"

viernes:
  organization_id: 58
  agent_id: 126
  platform: "whatsapp"
  max_turns: 12
  conversation_timeout: 300
  webhook_timeout: 60

simulated_user:
  prompt: |
    Eres Fabian Mejia, gerente de una empresa mediana.
    Tu empresa tiene ingresos anuales de EXACTAMENTE 350 millones de pesos.
    La empresa tiene 2 anos de antiguedad.
    Responde en espanol, de forma breve y cooperativa.

    Cuando te pregunten por email: fabian@empresamedia.com
    Cuando te pregunten nombre: Fabian Mejia
    Cuando pregunten si es empresa o persona natural: empresa
    Cuando pregunten nombre y NIT: Empresa Media SAS, NIT 900555666-7
    Cuando pregunten ingresos anuales: exactamente 350 millones
    Cuando pregunten antiguedad: 2 anos

    Si te preguntan si eres empleado o independiente: no aplica, represento empresa
    Si insisten: prefiero continuar como empresa

    Responde maximo 1-2 oraciones por mensaje.
  first_message: "Buenos dias, necesito informacion de renting para mi empresa"
  language: "es"
  llm: "gpt-4o-mini"
  temperature: 0.3
  max_tokens: 100

evaluation_criteria:
  - id: "correct-boundary-handling"
    name: "Manejo correcto de frontera"
    prompt: "El agente manejo correctamente el caso limite de 350M (deberia continuar con B2B, no redirigir a B2C)?"

  - id: "no-redirect-to-natural"
    name: "No redirige a persona natural"
    prompt: "El agente NO redirigio al flujo de persona natural (no pregunto si es empleado o independiente)?"

  - id: "no-b2c-questions"
    name: "Sin preguntas B2C"
    prompt: "El agente NO hizo preguntas de calificacion B2C (Datacredito personal, extractos personales, etc.)?"

  - id: "continues-b2b-flow"
    name: "Continua flujo B2B"
    prompt: "El agente continuo con el flujo B2B apropiado para la empresa?"

expected_structured_data:
  - field_name: "funnel"
    expected_value: "B2C"
    match_mode: "contains"
    capture_strategy: "last"
    required: false
    description: "El funnel NO debe contener B2C - test FALLA si la empresa fue redirigida a flujo B2C"
